<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Event Calendar</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <nav>
    <a href="index.html">Home</a> |
    <a href="calendar.html">Calendar</a> |
    <a href="events.html">Events</a> |
    <a href="volunteer.html">Volunteering</a> |
    <a href="support.html">Support a Cause</a> |
    <a href="latest-updates.html">Latest Updates</a> |
    <a href="activism.html">Activism</a>
  </nav>
  <main>
    <h1>Event Calendar</h1>
    <div style="text-align:left; margin: 1.5em 0 0.5em 0;">
      <a href="#" id="calendar-disclaimer-link" style="font-size:0.92em;text-decoration:underline;cursor:pointer;">Disclaimer</a>
    </div>
    <div style="margin: 2em 0;">
      <div style="text-align: center; margin-bottom: 1em;">
        <button id="prev-cal-month" style="margin-right:1em;padding:0.5em 0.75em;background:#007bff;color:white;border:none;border-radius:4px;cursor:pointer;">&#8592;</button>
        <input type="text" id="current-cal-month" value="August 2025" style="font-weight:bold;font-size:1.2em;text-align:center;border:2px solid #dee2e6;border-radius:6px;padding:0.5em 1em;margin:0 0.5em;min-width:200px;background:#f8f9fa;" placeholder="Month YYYY" />
        <button id="next-cal-month" style="margin-left:1em;padding:0.5em 0.75em;background:#007bff;color:white;border:none;border-radius:4px;cursor:pointer;">&#8594;</button>
      </div>
      <div style="text-align: center; margin-bottom: 1em; font-size: 0.9em; color: #6c757d;">
        <span>Type month and year (e.g., "January 2025" or "1/2025") and press Enter</span>
      </div>
      <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; max-width: 600px; margin: 0 auto; background: #ddd; border: 1px solid #ddd;">
        <div style="background: #f0f0f0; padding: 10px; text-align: center; font-weight: bold;">Sun</div>
        <div style="background: #f0f0f0; padding: 10px; text-align: center; font-weight: bold;">Mon</div>
        <div style="background: #f0f0f0; padding: 10px; text-align: center; font-weight: bold;">Tue</div>
        <div style="background: #f0f0f0; padding: 10px; text-align: center; font-weight: bold;">Wed</div>
        <div style="background: #f0f0f0; padding: 10px; text-align: center; font-weight: bold;">Thu</div>
        <div style="background: #f0f0f0; padding: 10px; text-align: center; font-weight: bold;">Fri</div>
        <div style="background: #f0f0f0; padding: 10px; text-align: center; font-weight: bold;">Sat</div>
        <div id="calendar-grid" style="grid-column: 1 / -1; display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px;">
          <!-- Days -->
        </div>
      </div>
      <div style="margin-top: 1em; text-align: center;">
        <p>Click on a day with events to see event details.</p>
      </div>
    </div>
  </main>

  <div id="calendar-disclaimer-popover" style="display:none;position:fixed;top:22%;left:50%;transform:translate(-50%,0);background:#fff;border:1px solid #888;box-shadow:0 4px 24px rgba(0,0,0,0.18);padding:2em;max-width:520px;z-index:1000;border-radius:8px;font-size:0.97em; text-align:left;">
    <strong>Disclaimer:</strong> Connect Utah Today provides a list of events for informational purposes only. We do not organize, operate, or officially endorse any of the events listed on this website unless explicitly stated. Event details, dates, times, and locations are subject to change without notice. Connect Utah Today is not responsible for the accuracy, reliability, or completeness of the information provided, nor for any issues, injuries, or losses that may arise from your participation in any event. Please verify event details directly with the event organizer before attending. By using this website, you acknowledge and accept that Connect Utah Today is not liable for any consequences resulting from your participation in or reliance on any event listed.
    <br><br>
    <button id="close-calendar-disclaimer" style="margin-top:1em;padding:0.5em 1.5em;">Close</button>
  </div>

  <!-- Event Details Popover -->
  <div id="event-details-overlay" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:998;"></div>
  <div id="event-details-popover" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;border:none;box-shadow:0 20px 60px rgba(0,0,0,0.3);padding:0;max-width:850px;max-height:85vh;overflow-y:auto;z-index:999;border-radius:16px;min-width:600px;">
    <div style="padding:2em 2.5em;border-bottom:1px solid #eee;background:linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;">
        <h2 id="event-title" style="margin:0;color:#212529;font-size:1.8em;line-height:1.2;font-weight:600;">Events</h2>
        <button id="close-event-details" style="background:#fff;border:2px solid #dee2e6;border-radius:50%;width:40px;height:40px;font-size:1.2em;color:#6c757d;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;box-shadow:0 2px 4px rgba(0,0,0,0.1);">&times;</button>
      </div>
    </div>
    <div style="padding:2em 2.5em;">
      <div id="event-details-content">
        <!-- Event details -->
      </div>
    </div>
  </div>

  <script>
    const orgImageMap = {
      'DSA': '/ConnectUtahToday/assets/DSA.jpg',
      'Democratic Socialists': '/ConnectUtahToday/assets/DSA.jpg',
      'PSL': '/ConnectUtahToday/assets/psl.jpg',
      'Party for Socialism': '/ConnectUtahToday/assets/psl.jpg',
      'Brown Berets': '/ConnectUtahToday/assets/BrownBerets.png',
      'SLC Mutual Aid': '/ConnectUtahToday/assets/SLCMutualAid.png',
      'Mutual Aid': '/ConnectUtahToday/assets/SLCMutualAid.png',
      'Wild Utah': '/ConnectUtahToday/assets/WildUtah.png',
      'Indivisible': '/ConnectUtahToday/assets/indivisible.png',
      'Beehive Collective': '/ConnectUtahToday/assets/beehiveCollectivePlaceholder.jpg',
      'Bakers for Palestine': '/ConnectUtahToday/assets/bakers_for_palestine_SLC.jpg'
    };
    const placeholderImage = '/ConnectUtahToday/assets/placeholder.jpg';

    let currentCalDate = new Date();
    let calendarEvents = {};

    // MONTH-BASED FETCHING FUNCTION
    function getCalendarApiUrlForMonth(date) {
      const year = date.getFullYear();
      const month = date.getMonth();
      const start = new Date(year, month, 1, 0, 0, 0);
      const end = new Date(year, month + 1, 0, 23, 59, 59);
      const startISO = start.toISOString();
      const endISO = end.toISOString();
      return `https://connectutahtoday-1.onrender.com/api/all-events?timeMin=${encodeURIComponent(startISO)}&timeMax=${encodeURIComponent(endISO)}`;
    }

    async function fetchEventsForCalendar() {
      try {
        const apiUrl = getCalendarApiUrlForMonth(currentCalDate);
        const response = await fetch(apiUrl);
        const data = await response.json();
        const events = (data.items || []).map(event => ({
          title: event.summary || event.title || 'Untitled Event',
          date: event.start?.dateTime || event.start?.date || event.date,
          location: event.location,
          description: event.description,
          url: event.htmlLink || event.url,
          source: event.source || 'google',
          featured_image_url: event.featured_image_url,
          event_type: event.event_type
        }));
        calendarEvents = {};
        events.forEach(event => {
          if (!event.date) return;
          const eventDateObj = new Date(event.date);
          if (isNaN(eventDateObj.getTime())) return;
          const key = `${eventDateObj.getFullYear()}-${eventDateObj.getMonth()}-${eventDateObj.getDate()}`;
          if (!calendarEvents[key]) calendarEvents[key] = [];
          calendarEvents[key].push(event);
        });
        renderCalendar();
      } catch (error) {
        console.error('Error fetching events for calendar:', error);
        renderCalendar();
      }
    }

    // The rest of your calendar rendering, event popover, disclaimer, and navigation code remains unchanged.
    // (You can copy it directly from your previous file.)

    // ... (calendar rendering and event popover functions here) ...

    document.getElementById('prev-cal-month').addEventListener('click', function() {
      currentCalDate.setMonth(currentCalDate.getMonth() - 1);
      fetchEventsForCalendar();
    });

    document.getElementById('next-cal-month').addEventListener('click', function() {
      currentCalDate.setMonth(currentCalDate.getMonth() + 1);
      fetchEventsForCalendar();
    });

    // ... (month/year input handling, disclaimer popover, event details popover, etc.) ...

    // Initialize calendar with events
    fetchEventsForCalendar();
  </script>
</body>
</html>